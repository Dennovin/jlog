# vim:ts=2:sw=2:noet:
CC=@CC@
CPPFLAGS=@CPPFLAGS@
CFLAGS=@CFLAGS@
LDFLAGS=@LDFLAGS@
AR=@AR@
RANLIB=@RANLIB@
LIBS=@LIBS@
INSTALL=@INSTALL@
SHLD=@SHLD@
PERL=@PERL@

prefix=@prefix@
exec_prefix=@exec_prefix@
bindir=@bindir@
sbindir=@sbindir@
libdir=@libdir@
includedir=${prefix}/include
libexecdir=@libexecdir@
datarootdir = @datarootdir@
mandir=@mandir@
mansubdir=@mansubdir@
docdir=${prefix}/@docdir@
sysconfdir=@sysconfdir@
srcdir=@srcdir@
top_srcdir=@top_srcdir@

LIBOBJS= \
	jlog.o jlog_hash.o jlog_io.o

all:	libjlog.so libjlog.a jlogctl test jlogperl

test:	jthreadtest

jlogperl:
	cd perl ; $(PERL) Makefile.PL
	cd perl ; make

jlogctl:	libjlog.a jlogctl.o
	$(CC) $(CFLAGS) -o jlogctl jlogctl.o libjlog.a $(LDFLAGS) $(LIBS)

jthreadtest:	libjlog.a jthreadtest.o
	$(CC) $(CFLAGS) -o jthreadtest jthreadtest.o libjlog.a $(LDFLAGS) $(LIBS)

libjlog.so: $(LIBOBJS)
	$(SHLD) -o libjlog.so $(LIBOBJS) $(LIBS)

libjlog.a:	$(LIBOBJS)
	$(AR) cq libjlog.a $(LIBOBJS)
	$(RANLIB) libjlog.a

.c.o:
	$(CC) $(CPPFLAGS) $(CFLAGS) -c $<

install:
	$(srcdir)/mkinstalldirs $(DESTDIR)$(bindir)
	$(srcdir)/mkinstalldirs $(DESTDIR)$(libdir)
	$(srcdir)/mkinstalldirs $(DESTDIR)$(includedir)
	$(INSTALL) -m 0755 jlogctl $(DESTDIR)$(bindir)/jlogctl
	$(INSTALL) -m 0755 libjlog.a $(DESTDIR)$(libdir)/libjlog.a
	$(INSTALL) -m 0755 libjlog.so $(DESTDIR)$(libdir)/libjlog.so
	$(INSTALL) -m 0644 jlog.h $(DESTDIR)$(includedir)/jlog.h
	cd perl ; make install DESTDIR=$(DESTDIR)

clean:
	rm -f *.o libjlog.a jthreadtest
	-if test -f perl/Makefile ; then cd perl ; make clean ; fi
